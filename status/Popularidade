using UnityEngine;
using UnityEngine.UI;

/* 

SISTEMA POPULARIDADE

- é um dos status do jogo
- se inicia em 50%
- tem uma velocidade de perda de 0.1
- quando FichaLimpa está acima de 80 (método AlmaHonesta), tem uma velocidade de ganho de 0.5
- O método CPI aumenta a velocidade de perda 
- o método AlmaHonesta aumenta a velocidade de ganho
- ambos os métodos estão na classe FichaLimpa

*/

public class Popularidade : MonoBehaviour
{

    public Text pop_txtUI;
    public float veloPerdaPop = 0.05f;
    public float veloGanhaPop = 0.5f;
    public float popularidade = 50;
    public float max_pop = 100;
    public float min_pop = 0;
    public Slider barraPop;
    public GameObject PartidoManager;
    float popLula, popCiro, popBolso, popDilma, popEneas, popSuplicy, popHaddard, popDodorio, popCunha;

    private void Awake()
    {

        popLula = PlayerPrefs.GetFloat("PopularidadeLula"); 
        popCiro = PlayerPrefs.GetFloat("PopularidadeCiro");  
        popBolso = PlayerPrefs.GetFloat("PopularidadeBolso"); 
        popDilma = PlayerPrefs.GetFloat("PopularidadeDilma"); 
        popEneas = PlayerPrefs.GetFloat("PopularidadeEneas"); 
        popSuplicy = PlayerPrefs.GetFloat("PopularidadeSuplicy"); 
        popHaddard = PlayerPrefs.GetFloat("PopularidadeHaddard"); 
        popDodorio = PlayerPrefs.GetFloat("PopularidadeDodorio"); 
        popCunha = PlayerPrefs.GetFloat("PopularidadeCunha"); 
    }

    void Start()
    {

        PopPersonagens();
  

    }

    void Update()
    {

        PopPersonagens();

    }

    void MaxMinPop()
    {
        if (popularidade <= 0)
        {
            popularidade = 0;
        }

        if (popularidade >= max_pop)
        {
            popularidade = max_pop;
        }
    }


    public void PopPersonagens()

    {
     
        MaxMinPop();

        PlayerPrefs.SetFloat("PopularidadeNaScene", popularidade);

        if (PartidoManager.GetComponent<Partido>().LulaDentroScene == 1)

        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeLula");
            float tempPopularidade = Mathf.Round(popLula);

            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);

          



            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //
            if (tempPopularidade <= 0)

            {
                tempPopularidade = 1;
            }


           // veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            // veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeLula");
            pop_txtUI.text = (Mathf.Round(popularidade).ToString()); // + "%");

            // ganho ou perda de pop

            if (this.gameObject.GetComponent<FichaLimpa>().almaHonesta == 0)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

                
           /* if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }*/

            if (this.gameObject.GetComponent<FichaLimpa>().almaHonesta == 1 && PlayerPrefs.GetFloat("PopularidadeLula") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (this.gameObject.GetComponent<FichaLimpa>().almaHonesta == 1 && PlayerPrefs.GetFloat("PopularidadeLula") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }
            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeLula", popularidade);

            if (popularidade <= 0)
            {
                popularidade = 0;

            }

            // max pop

            if (popularidade >= 100)
            {
                popularidade = 100;
            }


            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (this.gameObject.GetComponent<Influencia>().level <= 1 && popularidade <= 1)
            {
                //PlayerPrefs.SetFloat("PopularidadeLula", 50);
                popularidade = 50;
            }

        }
      
        
        if (PartidoManager.GetComponent<Partido>().CiroDentroScene == 1)
        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeCiro");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeCiro"));
            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);

            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");

            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeCiro");

            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //

            //------------------------------------------------

            // ganho ou perda de pop


            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeCiro") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeCiro") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeCiro", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeCiro") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeCiro", 0);
            }

            // max pop

            PlayerPrefs.SetFloat("PopularidadeCiro", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeCiro") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeCiro", 100);
            }



            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (PlayerPrefs.GetInt("LevelCiro") <= 1 && PlayerPrefs.GetFloat("PopularidadeCiro") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeCiro", 50);
            }


        }

      
        if (PartidoManager.GetComponent<Partido>().BolsoDentroScene == 1)
        {
            
            popularidade = PlayerPrefs.GetFloat("PopularidadeBolso");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeBolso"));
            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");
            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);

            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");


            popularidade = PlayerPrefs.GetFloat("PopularidadeBolso");


            //popularidade -= Time.deltaTime * veloPerdaPop;

            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //

            // ganho ou perda de pop

            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeBolso") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeBolso") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            //------------------------------------------------

            // MIN POP

            PlayerPrefs.SetFloat("PopularidadeBolso", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeBolso") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeBolso", 0);
            }

            // MAX POP 

            PlayerPrefs.SetFloat("PopularidadeBolso", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeBolso") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeBolso", 100);
            }

            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA


            if (PlayerPrefs.GetInt("LevelBolso") <= 1 && PlayerPrefs.GetFloat("PopularidadeBolso") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeBolso", 50);
            }

        }

        if (PartidoManager.GetComponent<Partido>().DilmaDentroScene == 1)
        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeDilma");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeDilma"));
            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");

            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeDilma");
            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);


            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //

            //------------------------------------------------

            // ganho ou perda de pop


            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeDilma") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeDilma") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeDilma", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeDilma") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeDilma", 0);
            }

            // max pop

            PlayerPrefs.SetFloat("PopularidadeDilma", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeDilma") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeDilma", 100);
            }



            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (PlayerPrefs.GetInt("LevelDilma") <= 1 && PlayerPrefs.GetFloat("PopularidadeDilma") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeDilma", 50);
            }


        }

        if (PartidoManager.GetComponent<Partido>().SuplicyDentroScene == 1)
        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeSuplicy");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeSuplicy"));
            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");
            PlayerPrefs.SetFloat("PopularidadeNaScene", popularidade);


            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeSuplicy");
            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);


            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //

            //------------------------------------------------

            // ganho ou perda de pop


            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeSuplicy") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeSuplicy") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeSuplicy", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeSuplicy") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeSuplicy", 0);
            }

            // max pop

            PlayerPrefs.SetFloat("PopularidadeSuplicy", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeSuplicy") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeSuplicy", 100);
            }



            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (PlayerPrefs.GetInt("LevelSuplicy") <= 1 && PlayerPrefs.GetFloat("PopularidadeSuplicy") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeSuplicy", 50);
            }


        }

        if (PartidoManager.GetComponent<Partido>().EneasDentroScene == 1)
        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeEneas");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeEneas"));
            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");
            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);


            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeEneas");

            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //

            //------------------------------------------------

            // ganho ou perda de pop


            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeEneas") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeEneas") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeEneas", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeEneas") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeEneas", 0);
            }

            // max pop

            PlayerPrefs.SetFloat("PopularidadeEneas", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeEneas") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeEneas", 100);
            }



            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (PlayerPrefs.GetInt("LevelEneas") <= 1 && PlayerPrefs.GetFloat("PopularidadeEneas") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeEneas", 50);
            }


        }

        if (PartidoManager.GetComponent<Partido>().DodorioDentroScene == 1)

        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeDodorio");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeDodorio"));

            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);





            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //
            if (tempPopularidade <= 0)

            {
                tempPopularidade = 1;
            }
            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");


            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeDodorio");

            // ganho ou perda de pop

            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeDodorio") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeDodorio") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }
            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeDodorio", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeDodorio") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeDodorio", 0);

            }

            // max pop
            PlayerPrefs.SetFloat("PopularidadeDodorio", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeDodorio") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeDodorio", 100);
            }


            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (PlayerPrefs.GetInt("LevelDodorio") <= 1 && PlayerPrefs.GetFloat("PopularidadeDodorio") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeDodorio", 50);

            }

        }
    
        if (PartidoManager.GetComponent<Partido>().HaddardDentroScene == 1)

        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeHaddard");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeHaddard"));

            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);





            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //
            if (tempPopularidade <= 0)

            {
                tempPopularidade = 1;
            }
            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");


            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeHaddard");

            // ganho ou perda de pop

            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeHaddard") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeHaddard") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }
            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeHaddard", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeHaddard") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeHaddard", 0);

            }

            // max pop
            PlayerPrefs.SetFloat("PopularidadeHaddard", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeHaddard") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeHaddard", 100);
            }


            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (PlayerPrefs.GetInt("LevelHaddard") <= 1 && PlayerPrefs.GetFloat("PopularidadeHaddard") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeHaddard", 50);

            }

        }
    
        if (PartidoManager.GetComponent<Partido>().CunhaDentroScene == 1)

        {
            popularidade = PlayerPrefs.GetFloat("PopularidadeCunha");
            float tempPopularidade = Mathf.Round(PlayerPrefs.GetFloat("PopularidadeCunha"));

            PlayerPrefs.SetFloat("PopularidadeNaScene", tempPopularidade);





            // BARRA POP

            barraPop.maxValue = max_pop;
            barraPop.value = popularidade;

            //
            if (tempPopularidade <= 0)

            {
                tempPopularidade = 1;
            }
            pop_txtUI.text = (tempPopularidade.ToString()); // + "%");


            veloPerdaPop = PlayerPrefs.GetFloat("VeloPerdaPop");
            veloGanhaPop = PlayerPrefs.GetFloat("VeloGanhaPop");

            popularidade = PlayerPrefs.GetFloat("PopularidadeCunha");

            // ganho ou perda de pop

            if (PlayerPrefs.GetInt("AlmaHonesta") == 0)

            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeCunha") <= 51)
            {
                popularidade += Time.deltaTime * veloGanhaPop;

            }

            if (PlayerPrefs.GetInt("AlmaHonesta") == 1 && PlayerPrefs.GetFloat("PopularidadeCunha") > 51)
            {
                popularidade -= Time.deltaTime * veloPerdaPop;

            }
            //------------------------------------------------

            // min pop

            PlayerPrefs.SetFloat("PopularidadeCunha", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeCunha") <= 0)
            {
                PlayerPrefs.SetFloat("PopularidadeCunha", 0);

            }

            // max pop
            PlayerPrefs.SetFloat("PopularidadeCunha", popularidade);

            if (PlayerPrefs.GetFloat("PopularidadeCunha") >= 100)
            {
                PlayerPrefs.SetFloat("PopularidadeCunha", 100);
            }


            // VERIFICAR SE É A PRIMEIRA VEZ QUE JOGA

            if (PlayerPrefs.GetInt("LevelCunha") <= 1 && PlayerPrefs.GetFloat("PopularidadeCunha") <= 1)
            {
                PlayerPrefs.SetFloat("PopularidadeCunha", 50);

            }

        }
    
    }

    public void deletePlayerPrefs()
    {
        PlayerPrefs.DeleteAll();

    }

    // save playerprefs


}
