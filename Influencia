using UnityEngine;
using UnityEngine.UI;
using System;


public class Influencia : MonoBehaviour
{

    public float influencia = 100;
    private float maxInflu = 100;
    private float minInflu;

    public Text influ_txtUI;

    public float veloPerdaInflu;

    public int level;
    public int max_level;
    public Text level_txtUI;

    int indiceInfluPersonagens; // DETERMINA QUAL PERSONAGEM DEVE TER SUA INFLU ALTERADA (QUEM TA NA SCENE)

    private float perdaPop;
    private int tempLevel;

    private int tempPop;
    public int i = 0;

    public bool perdeuLevel = false;



    void Start()
    {
        //PlayerPrefs.DeleteAll();

        InfluPersonagens();
        PerdaInflu();
    }



    void Update()
    {
        PerdaInflu();
        InfluPersonagens();
    }

    // PERDA DE INFLUÊNCIA (EM CASO DE CPI) E PERDA DE LEVEL (AO ATINGIR MIN DE POP)
    public void PerdaInflu()

    {
        if (PlayerPrefs.GetInt("CPI") == 1)
        {
            veloPerdaInflu = 0.3f;

            switch (indiceInfluPersonagens)
            {
                case 0:
                    PlayerPrefs.SetFloat("InfluLula", PlayerPrefs.GetFloat("InfluLula") - Time.deltaTime * veloPerdaInflu);
                     tempPop = (int)Mathf.Round(PlayerPrefs.GetFloat("PopularidadeLula"));
                    if (tempPop == 95 && perdeuLevel == false)
                    {
                        perdeuLevel = true;

                        level = PlayerPrefs.GetInt("LevelLula");
                        PlayerPrefs.SetInt("LevelPerdeuLula", Math.Abs(level - 1));
                        if (i < 1)
                        {
                            PlayerPrefs.SetInt("LevelLula", PlayerPrefs.GetInt("LevelPerdeuLula"));
                            i++;
                        }


                    }
                    else
                    {
                        perdeuLevel = false;
                    }
                    break;

                case 1:
                    PlayerPrefs.SetFloat("InfluCiro", PlayerPrefs.GetFloat("InfluCiro") - Time.deltaTime * veloPerdaInflu);
                       tempPop = (int)Mathf.Round(PlayerPrefs.GetFloat("PopularidadeCiro"));
                    if (tempPop == 95 && perdeuLevel == false)
                    {
                        perdeuLevel = true;

                        level = PlayerPrefs.GetInt("LevelCiro");
                        PlayerPrefs.SetInt("LevelPerdeuCiro", Math.Abs(level - 1));

                        if (i < 1)
                        {
                            PlayerPrefs.SetInt("LevelCiro", PlayerPrefs.GetInt("LevelPerdeuCiro"));
                            i++;
                        }


                    }
                    else
                    {
                        perdeuLevel = false;
                    }


                    break;

                case 2:
                    PlayerPrefs.SetFloat("InfluBolso", PlayerPrefs.GetFloat("InfluBolso") - Time.deltaTime * veloPerdaInflu);

                       tempPop = (int)Mathf.Round(PlayerPrefs.GetFloat("PopularidadeBolsonaro"));
                    if (tempPop == 40 && perdeuLevel == false)
                    {
                        perdeuLevel = true;

                        level = PlayerPrefs.GetInt("LevelBolso");
                        PlayerPrefs.SetInt("LevelPerdeuBolso", Math.Abs(level - 1));
                        if (i < 1)
                        {
                            PlayerPrefs.SetInt("LevelBolso", PlayerPrefs.GetInt("LevelPerdeuBolso"));
                            i++;
                        }


                    }
                    else
                    {
                        perdeuLevel = false;
                    }


                    break;
            }

        }

        if (PlayerPrefs.GetInt("CPI") == 0)
        {
            veloPerdaInflu = 0f;
        }

    }


    // usado no button de recompensas
    public void GanhaInflu() 
    {
        float cresceInflu = 30;

        switch (indiceInfluPersonagens)
        {
            case 0:
                PlayerPrefs.SetFloat("InfluLula", PlayerPrefs.GetFloat("InfluLula") + cresceInflu);
                break;

            case 1:
                PlayerPrefs.SetFloat("InfluCiro", PlayerPrefs.GetFloat("InfluCiro") + cresceInflu);
                break;
            case 2:
                PlayerPrefs.SetFloat("InfluBolso", PlayerPrefs.GetFloat("InfluBolso") + cresceInflu);
                break;

        }

    }

    // INFLUÊNCIA E GANHO DE LEVEL
    public void InfluPersonagens()

    {

        if (PlayerPrefs.GetInt("LulaDentroScene") == 1)

        {
            indiceInfluPersonagens = 0;

            level = PlayerPrefs.GetInt("LevelLula");

            level_txtUI.text = "LVL: " + level.ToString();


            influencia = Mathf.Round(PlayerPrefs.GetFloat("InfluLula", influencia));
            influ_txtUI.text = (influencia.ToString() + "%");


            if (PlayerPrefs.GetInt("LevelLula") <= 0)
            {
                PlayerPrefs.SetInt("LevelLula", 0);
            }


            if (PlayerPrefs.GetFloat("InfluLula") >= maxInflu)
            {
                PlayerPrefs.SetFloat("InfluLula", 0);
                level += 1;
                PlayerPrefs.SetInt("LevelLula", level);
                i = 0;

            }

            if (PlayerPrefs.GetFloat("InfluLula") <= minInflu)
            {
                PlayerPrefs.SetFloat("InfluLula", minInflu);

            }



        }


        if (PlayerPrefs.GetInt("CiroDentroScene") == 1)
        {
            indiceInfluPersonagens = 1;

            level = PlayerPrefs.GetInt("LevelCiro");

            level_txtUI.text = "LVL: " + level.ToString();

            if (PlayerPrefs.GetInt("LevelCiro") <= 0)
            {
                PlayerPrefs.SetInt("LevelCiro", 0);
            }

            influencia = Mathf.Round(PlayerPrefs.GetFloat("InfluCiro", influencia));
            influ_txtUI.text = (influencia.ToString() + "%");



            if (PlayerPrefs.GetFloat("InfluCiro") >= maxInflu)
            {
                PlayerPrefs.SetFloat("InfluCiro", 0);
                level += 1;
                PlayerPrefs.SetInt("LevelCiro", level);
                i = 0;
            }
            if (PlayerPrefs.GetFloat("InfluCiro") <= minInflu)
            {
                PlayerPrefs.SetFloat("InfluCiro", minInflu);

            }

        }


        if (PlayerPrefs.GetInt("BolsoDentroScene") == 1)
        {
            indiceInfluPersonagens = 2;

            level = PlayerPrefs.GetInt("LevelBolso");

            level_txtUI.text = "LVL: " + level.ToString();

            if (PlayerPrefs.GetInt("LevelBolso") <= 0)
            {
                PlayerPrefs.SetInt("LevelBolso", 0);
            }

            influencia = Mathf.Round(PlayerPrefs.GetFloat("InfluBolso", influencia));
            influ_txtUI.text = (influencia.ToString() + "%");



            if (PlayerPrefs.GetFloat("InfluBolso") >= maxInflu)
            {
                PlayerPrefs.SetFloat("InfluBolso", 0);
                level += 1;
                PlayerPrefs.SetInt("LevelBolso", level);
                i = 0;

            }




            if (PlayerPrefs.GetFloat("InfluBolso") <= minInflu)
            {
                PlayerPrefs.SetFloat("InfluBolso", minInflu);

            }



        }





    }



}


